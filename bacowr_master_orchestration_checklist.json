{
  "_global_instructions": {
    "description": "This checklist is the single source of truth for the BACOWR system.",
    "rules": [
      "For every module and task in this file, always check the existing repository first.",
      "If an equivalent implementation already exists under src/ (or other folders), REUSE and extend it instead of creating a parallel structure.",
      "Keep all code and docs consistent with this checklist: update the 'status', 'priority' and 'dependencies' fields instead of inventing new modules.",
      "Follow the dependencies between modules when planning work: do not fully implement a dependent module before its prerequisites are at least partial.",
      "Any new file, folder or refactor must be justified by a task in this checklist."
    ]
  },
  "project_name": "BACOWR Checklist",
  "description": "A comprehensive checklist for building the BACOWR system end-to-end, including backend, preflight, LLM integration, storage, QA, API, frontend, and deployment.",
  "modules": [
    {
      "module_id": "A",
      "name": "Repository & Core Docs",
      "status": "unknown",
      "depends_on": [],
      "tasks": [
        {
          "id": "A1",
          "title": "Root structure",
          "description": "Ensure core files and directories exist at the repository root. Create them with sensible content if missing.",
          "required_files_dirs": [
            "README.md",
            "BACOWR_ARCHITECTURE.md",
            "MODULES_AND_TASKS.md",
            "requirements.txt",
            "docs/",
            "tools/",
            "output/"
          ],
          "status": "unknown",
          "priority": "high",
          "dependencies": []
        },
        {
          "id": "A2",
          "title": "Architecture docs",
          "description": "BACOWR_ARCHITECTURE.md must describe the high-level flow (Input → Preflight → LLM → Storage → QA → API → Frontend) and explicitly mention Light vs Heavy Preflight and the API-first backend. MODULES_AND_TASKS.md must contain task-style descriptions for key components (Domain models, API gateway, Orchestrator, etc.) and serve as a 'task bible'.",
          "status": "unknown",
          "priority": "high",
          "dependencies": ["A1"]
        }
      ]
    },
    {
      "module_id": "B",
      "name": "Domain Models & Config",
      "status": "unknown",
      "depends_on": ["A"],
      "tasks": [
        {
          "id": "B1",
          "title": "Core models",
          "description": "Create/verify domain models (e.g. JobInput, PreflightResult, LLMResult, ArticleRecord, Batch, JobStatus, BatchStatus) in a central models module. Models must have type-hinted fields, docstrings and be pure data containers.",
          "models": [
            "JobInput",
            "PreflightResult",
            "LLMResult",
            "ArticleRecord",
            "Batch",
            "JobStatus",
            "BatchStatus"
          ],
          "status": "unknown",
          "priority": "high",
          "dependencies": ["A1"]
        },
        {
          "id": "B2",
          "title": "Config",
          "description": "Create a config/settings module (e.g. BACOWRSettings) powered by environment variables (LLM API key, model name, output paths) and a cached get_settings() helper.",
          "status": "unknown",
          "priority": "high",
          "dependencies": ["B1"]
        }
      ]
    },
    {
      "module_id": "C",
      "name": "Preflight Engine (Light v1)",
      "status": "unknown",
      "depends_on": ["B"],
      "tasks": [
        {
          "id": "C1",
          "title": "Light Preflight implementation",
          "description": "Implement a Light Preflight function run_light_preflight(job: JobInput) -> PreflightResult that fetches HTML, extracts key data (title, meta, H1, paragraphs), builds basic publisher/target profiles and fills PreflightResult.research_prompt with a well-structured prompt for the LLM.",
          "status": "unknown",
          "priority": "high",
          "dependencies": ["B1", "B2"]
        },
        {
          "id": "C2",
          "title": "Light preflight docs",
          "description": "Add/update docs/preflight_light.md describing inputs, steps, limitations (no advanced Heavy logic yet) and one or more result examples.",
          "status": "unknown",
          "priority": "medium",
          "dependencies": ["C1"]
        }
      ]
    },
    {
      "module_id": "D",
      "name": "LLM Client",
      "status": "unknown",
      "depends_on": ["B", "C"],
      "tasks": [
        {
          "id": "D1",
          "title": "Backend LLM client",
          "description": "Implement generate_article(preflight: PreflightResult, model_name: str | None = None) -> LLMResult in an llm client module to call the external LLM API (Claude/GPT) via HTTP, handling errors and timeouts, and returning markdown text and token usage.",
          "status": "unknown",
          "priority": "high",
          "dependencies": ["B2", "C1"]
        },
        {
          "id": "D2",
          "title": "Test helper",
          "description": "Create an optional CLI script (e.g. tools/test_llm_client.py) to take a fake PreflightResult JSON file and print the generated markdown for quick sanity tests.",
          "status": "unknown",
          "priority": "low",
          "dependencies": ["D1"]
        }
      ]
    },
    {
      "module_id": "E",
      "name": "Orchestrator (Single Job + Batch)",
      "status": "unknown",
      "depends_on": ["B", "C", "D", "F", "G"],
      "tasks": [
        {
          "id": "E1",
          "title": "Single-job orchestrator",
          "description": "Implement run_single_job(job_input: JobInput) -> ArticleRecord in a services/orchestrator module to sequence the light preflight, LLM call, storage persistence and initial QA, returning a fully populated ArticleRecord.",
          "status": "unknown",
          "priority": "high",
          "dependencies": ["C1", "D1", "F1", "G1"]
        },
        {
          "id": "E2",
          "title": "Batch orchestrator skeleton",
          "description": "Define run_batch(batch_id: str | int) -> BatchStatus that loads a batch of jobs (from CSV/JSON or later DB), loops run_single_job(), aggregates status per job and per batch, and adds TODOs for future DB integration.",
          "status": "unknown",
          "priority": "high",
          "dependencies": ["E1", "F1"]
        }
      ]
    },
    {
      "module_id": "F",
      "name": "Storage Layer (Filesystem v1, DB-ready)",
      "status": "unknown",
      "depends_on": ["A"],
      "tasks": [
        {
          "id": "F1",
          "title": "File-based storage",
          "description": "Implement save_article_record and load_article_record using a structured output directory (e.g. output/articles/{id}.md, output/metadata/{id}.json), ensuring UTF-8 encoding and error logging.",
          "status": "unknown",
          "priority": "high",
          "dependencies": ["A1"]
        },
        {
          "id": "F2",
          "title": "Future DB integration hook",
          "description": "Create a db_stub module with interfaces/placeholders for database functions and clear comments about future Airtable/Postgres integration.",
          "status": "unknown",
          "priority": "medium",
          "dependencies": ["F1"]
        }
      ]
    },
    {
      "module_id": "G",
      "name": "QA & Status (Initial + Day 2 hooks)",
      "status": "unknown",
      "depends_on": ["B", "F"],
      "tasks": [
        {
          "id": "G1",
          "title": "Initial QA",
          "description": "Implement initial_qa_evaluation(record: ArticleRecord) -> ArticleRecord in a qa/service module to perform word count checks (>= 900), anchor text checks, set qa_status to 'pending_review' and set simple auto_flags.",
          "status": "unknown",
          "priority": "high",
          "dependencies": ["B1", "F1"]
        },
        {
          "id": "G2",
          "title": "Manual QA update",
          "description": "Implement set_qa_status(record_id: str, new_status: str, comment: str | None) -> None to update metadata via the storage layer.",
          "status": "unknown",
          "priority": "high",
          "dependencies": ["G1", "F1"]
        },
        {
          "id": "G3",
          "title": "Day 2 QA workflow model",
          "description": "Define a Day 2 QA workflow for 175-link batches: statuses, transitions, who reviews what, and how QA decisions are stored per article and per batch. Document this in docs/day2_qa_workflow.md and ensure the storage layer can represent QA state.",
          "status": "unknown",
          "priority": "high",
          "dependencies": ["E2", "F1", "N1"]
        },
        {
          "id": "G4",
          "title": "Batch QA progress & reporting",
          "description": "Add helper functions (e.g. in a qa/batch_qa module) to compute QA progress per batch (approved/pending/revise counts) and expose this via the storage/API layer for dashboards or frontend views.",
          "status": "unknown",
          "priority": "medium",
          "dependencies": ["G3", "E2", "H1"]
        }
      ]
    },
    {
      "module_id": "H",
      "name": "API Gateway (FastAPI eller liknande)",
      "status": "unknown",
      "depends_on": ["E", "B"],
      "tasks": [
        {
          "id": "H1",
          "title": "FastAPI app",
          "description": "Implement get_app() -> FastAPI in an api/server module with a POST /jobs/full-run endpoint that takes JobInput, calls run_single_job and returns the ArticleRecord JSON. Include a /health endpoint.",
          "status": "unknown",
          "priority": "high",
          "dependencies": ["E1", "B1", "B2"]
        },
        {
          "id": "H2",
          "title": "Uvicorn entrypoint",
          "description": "Create a main entrypoint (e.g. bacowr/api/main.py or main.py) to run the FastAPI app using uvicorn.run() on host 0.0.0.0 and port 8000.",
          "status": "unknown",
          "priority": "high",
          "dependencies": ["H1"]
        }
      ]
    },
    {
      "module_id": "I",
      "name": "CLI / Research Export (Keyless Mode)",
      "status": "unknown",
      "depends_on": ["C"],
      "tasks": [
        {
          "id": "I1",
          "title": "Research export CLI",
          "description": "Ensure a CLI script (e.g. tools/research_export.py) takes arguments (--publisher, --target, --anchor, --country), runs the preflight pipeline (without LLM), and creates a 'keyless prompt' (to file, stdout or clipboard) for use in any LLM.",
          "status": "unknown",
          "priority": "medium",
          "dependencies": ["C1"]
        }
      ]
    },
    {
      "module_id": "J",
      "name": "API Contract & Hoppscotch",
      "status": "unknown",
      "depends_on": ["H", "E"],
      "tasks": [
        {
          "id": "J1",
          "title": "API Contract doc",
          "description": "Create docs/frontend_and_api_contract.md with complete request/response examples for POST /jobs/full-run, error payloads and Hoppscotch configuration.",
          "status": "unknown",
          "priority": "medium",
          "dependencies": ["H1", "E1"]
        },
        {
          "id": "J2",
          "title": "Hoppscotch usage",
          "description": "Add a section on 'How to call BACOWR from Hoppscotch' in the contract doc, detailing URL, method, headers, body and an example payload.",
          "status": "unknown",
          "priority": "low",
          "dependencies": ["J1"]
        }
      ]
    },
    {
      "module_id": "K",
      "name": "Frontend Webapp (Minimal Editor)",
      "status": "unknown",
      "depends_on": ["H"],
      "tasks": [
        {
          "id": "K1",
          "title": "Webapp skeleton",
          "description": "Create a webapp/ folder with a minimal frontend (e.g. Vite+React or simple HTML/JS). The frontend must have input fields for Publisher, Target URL, Anchor Text, a 'Generate article' button, call the backend API and display results in a text area/editor.",
          "status": "unknown",
          "priority": "high",
          "dependencies": ["H1"]
        },
        {
          "id": "K2",
          "title": "Dev server / proxy",
          "description": "Configure the webapp dev server (e.g. Vite proxy) to target the backend API at http://localhost:8000. Document run instructions (npm install, npm run dev) in README.md.",
          "status": "unknown",
          "priority": "medium",
          "dependencies": ["K1"]
        }
      ]
    },
    {
      "module_id": "L",
      "name": "Deployment & Ops",
      "status": "unknown",
      "depends_on": ["H", "K"],
      "tasks": [
        {
          "id": "L1",
          "title": "Docker",
          "description": "Create a Dockerfile for the backend (Python base image, install requirements, expose port 8000, run uvicorn). Optionally add docker-compose.yml for api/webapp services.",
          "status": "unknown",
          "priority": "medium",
          "dependencies": ["H2", "K1"]
        },
        {
          "id": "L2",
          "title": "Logging & error handling",
          "description": "Ensure Orchestrator, Preflight, LLM client and Storage modules log errors using the logging module and that stack traces do not leak to clients in production.",
          "status": "unknown",
          "priority": "high",
          "dependencies": ["E1", "C1", "D1", "F1"]
        }
      ]
    },
    {
      "module_id": "M",
      "name": "Heavy Preflight Stubs",
      "status": "unknown",
      "depends_on": ["C", "B"],
      "tasks": [
        {
          "id": "M1",
          "title": "Heavy design doc",
          "description": "Create docs/preflight_heavy.md summarizing Heavy concepts (intent extension, trust policy, anchor risk, QC, SERP research extensions, LSI windows), explaining it is a v2 feature requiring SERP APIs and more logic.",
          "status": "unknown",
          "priority": "low",
          "dependencies": ["C1"]
        },
        {
          "id": "M2",
          "title": "Heavy preflight skeleton",
          "description": "Implement run_heavy_preflight(job: JobInput) -> PreflightResult in a heavy_preflight module that currently reuses the Light logic but allows the Orchestrator to select the 'heavy' mode via JobInput.mode.",
          "status": "unknown",
          "priority": "medium",
          "dependencies": ["M1", "B1"]
        }
      ]
    },
    {
      "module_id": "N",
      "name": "Tests & Sanity Checks",
      "status": "unknown",
      "depends_on": ["C", "D", "H"],
      "tasks": [
        {
          "id": "N1",
          "title": "Basic tests",
          "description": "Add a tests/ folder with minimal tests ensuring: Light preflight returns a PreflightResult, the LLM client can be mocked to check orchestrator behavior and the API /health returns 200.",
          "status": "unknown",
          "priority": "high",
          "dependencies": ["C1", "D1", "H1"]
        },
        {
          "id": "N2",
          "title": "Manual smoke test instructions",
          "description": "Update README.md with step-by-step instructions for a manual smoke test, including setting up the venv, installing requirements, running the main API entrypoint, hitting the API with curl/Hoppscotch and running the frontend webapp.",
          "status": "unknown",
          "priority": "medium",
          "dependencies": ["H2", "K1"]
        }
      ]
    }
  ]
}
